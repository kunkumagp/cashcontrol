<!DOCTYPE html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script>
    localStorage.setItem("page", "income");
    $(function () {
        $("#header").load("inc/header.html");
        $("#top").load("inc/top.html");
        $("#left").load("inc/left_nav.html");
    });
    var api = localStorage.getItem("api");
    var userId = localStorage.getItem("userId");

    $.get(api + "totalIncome/"+userId, function (data) {
        document.getElementById("tAmount").innerHTML = data;
    });



</script>
<link rel="stylesheet" href="js/datatables/datatables.css" type="text/css"/>
<div id="header"></div>

</head>
<body class="">
<section class="vbox">
    <div id="top"></div>
    <section>
        <section class="hbox stretch">
            <!-- .aside -->
            <aside class="bg-black aside-md hidden-print" id="nav">
                <div id="left"></div>
            </aside>
            <!-- /.aside -->
            <section id="content">
                <section class="vbox">
                    <section class="scrollable padder">
                        <div class="m-b-md">
                            <div style="float: right;"><a href="addnewincome.html" class="btn btn-s-md btn-primary">Add
                                New Income</a></div>
                            <h3 class="m-b-none">Incomes</h3>
                            <small><a href="index.html">Home</a> / <span class="m-t-xs text-success">Incomes</span>
                            </small>
                        </div>
                        <section class="panel panel-default">
                            <header class="panel-heading">
                                <h4>
                                    <div class="">Total Incomes : <span id="cur"></span> <strong><span id="tAmount"></span></strong></div>
                                </h4>
                            </header>
                            <div class="table-responsive">

                                <table class="table table-striped m-b-none" data-ride="datatables" id="incomeTable">
                                    <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>Amount</th>
                                        <th>Category</th>
                                    </tr>
                                    </thead>
                                    <tbody role="alert" aria-live="polite" aria-relevant="all" id="tbody_income">

                                    </tbody>
                                </table>
                            </div>
                            <script>

                                $.get(api+"getIncome/"+userId, function (data) {
                                    var myBooks = data;
                                    console.log(myBooks);

                                    var col = [];
                                    for (var i = 0; i < myBooks.length; i++) {
                                        for (var key in myBooks[i]) {
                                            if (col.indexOf(key) === -1) {
                                                col.push(key);
                                            }
                                        }
                                    }

                                    var table = document.getElementById("tbody_income");
                                    for (var i = 0; i < myBooks.length; i++) {
                                        tr = table.insertRow(-1);
                                        for (var j = 0; j < 4; j++) {
                                            var tabCell = tr.insertCell(-1);
                                            var cat2 = myBooks[i]['category']['title'];
                                            tabCell.innerHTML = myBooks[i][col[j]];
                                            if (j === 3) {
                                                tabCell.innerHTML = cat2;
                                            }
                                        }
                                        var id = myBooks[i]['id'];

                                        tabCell.innerHTML += '<button onclick="deleteIncome(' + id + ')" class="actionstyle btn btn-danger">Delete</button><button onclick="editIncome(' + id + ')" class="actionstyle btn btn-primary">Edit</button>';
                                    }

                                    $('[data-ride="datatables"]').each(function () {
                                        var categoryTable = document.getElementById("incomeTable");
                                        var oTable = $(categoryTable).dataTable({
                                            "bProcessing": true,
                                            "sDom": "<'row'<'col-sm-6'l><'col-sm-6'f>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
                                            "sPaginationType": "full_numbers",
                                            "aoColumns": [
                                                {"mData": "id"},
                                                {"mData": "title"},
                                                {"mData": "amount"},
                                                {"mData": "category"}
                                            ]
                                        });
                                    });
                                });

                                function viewIncome(id) {
                                    $.get(api+"viewIncome/" + id, function (data) {
                                        window.location.replace("viewIncome.html?id=" + data['id']);
                                    });
                                }
                                function editIncome(id) {
                                    $.get(api+"editIncome/" + id, function (data) {
                                        window.location.replace("editIncome.html?id=" + data['id']);
                                    });
                                }
                                function deleteIncome(id) {
                                    $.post(api+"deleteIncome/" + id, function () {
                                        window.location.replace("income.html");
                                    });
                                }
                                document.getElementById("cur").innerHTML = localStorage.getItem('cur');
                            </script>
                        </section>
                    </section>
                </section>
                <a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen" data-target="#nav"></a>
            </section>
        </section>
    </section>
</section>
<script src="js/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="js/bootstrap.js"></script>
<!-- App -->
<script src="js/app.js"></script>
<script src="js/slimscroll/jquery.slimscroll.min.js"></script>
<!-- datatables -->
<script src="js/datatables/jquery.dataTables.min.js"></script>
<script src="js/datatables/jquery.csv-0.71.min.js"></script>
<!--<script src="js/datatables/demo.js"></script>-->
<script src="js/app.plugin.js"></script>
</body>
</html>
