<!DOCTYPE html> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 

<script>
    localStorage.setItem("page", "store");
    $(function () {
        $("#header").load("inc/header.html");
        $("#top").load("inc/top.html");
        $("#left").load("inc/left_nav.html");
    });
    var api = localStorage.getItem("api");
    var userId = localStorage.getItem("userId");

    $.get(api + "totalWallet/" + userId, function (data) {
        document.getElementById("tAmount").innerHTML = data;
    });



</script> 
<link rel="stylesheet" href="js/datatables/datatables.css" type="text/css"/> 
<div id="header"></div> 

</head> 
<body class=""> 
    <section class="vbox"> 
        <div id="top"></div> 
        <section> 
            <section class="hbox stretch"> 
                <!-- .aside --> 
                <aside class="bg-black aside-md hidden-print" id="nav"> 
                    <div id="left"></div> 
                </aside> 
                <!-- /.aside --> 
                <section id="content"> 
                    <section class="vbox"> 
                        <section class="scrollable padder"> 
                            <div class="m-b-md"> 
                                <h3 class="m-b-none">Wallet</h3> 
                                <small><a href="index.html">Home</a> / <a href="store.html">Stores</a> / <span class="m-t-xs text-success">Wallet</span> 
                                </small> 
                            </div> 
                            <section class="panel panel-default"> 
                                <header class="panel-heading"> 
                                    <h4> 
                                        <div class="">Total : <span id="cur"></span> <strong><span id="tAmount"></span></strong></div> 
                                    </h4> 
                                </header> 

                                <div class="table-responsive"> 

                                    <table class="table table-striped m-b-none" data-ride="datatables" id="incomeTable"> 
                                        <thead> 
                                            <tr> 
                                                <th>Date & Time</th> 
                                                <th>Title</th> 
                                                <th>Amount</th> 
                                                <th>Store</th> 
                                            </tr> 
                                        </thead> 
                                        <tbody role="alert" aria-live="polite" aria-relevant="all" id="tbody_income"> 

                                        </tbody> 
                                    </table> 
                                </div> 
                                <script>

                                    $.get(api + "getWallet/" + userId, function (data) {


                                        var sorted = data.sort(function IHaveAName(a, b) {
                                            return a.updated_at < b.updated_at ? 1
                                                    : a.updated_at > b.updated_at ? -1
                                                    : 0;
                                        });


                                        var myBooks = sorted;

                                        var col = [];
                                        for (var i = 0; i < myBooks.length; i++) {
                                            for (var key in myBooks[i]) {
                                                if (col.indexOf(key) === -1) {
                                                    col.push(key);
                                                }
                                            }
                                        }

                                        var table = document.getElementById("tbody_income");
                                        for (var i = 0; i < myBooks.length; i++) {
                                            tr = table.insertRow(-1);
                                            
                                            for (var j = 0; j < 4; j++) {
                                                var tabCell = tr.insertCell(-1);
                                                var catType = myBooks[i]['category']['type'];
                                                tabCell.innerHTML = myBooks[i][col[j]];
                                                if (j === 3) {
                                                    tabCell.innerHTML = catType;
                                                }
                                                if(j === 0){
                                                    tabCell.innerHTML = myBooks[i]['updated_at'];
                                                }
                                            }

                                            var id = myBooks[i]['id'];


                                            tabCell.innerHTML += '<button class="actionstyle btn btn-danger" data-toggle="modal" data-target="#' + id + '">Delete</button><button onclick="editIncome(' + id + ')" class="actionstyle btn btn-primary">Edit</button>';
                                            tabCell.innerHTML += '<div class="modal fade" id="' + id + '" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">Are you sure you want to <b>Delete</b> this record?</h4></div><div class="modal-body">Title : <b>' + myBooks[i]['title'] + '</b><br/>Amount : <b>' + myBooks[i]['amount'] + '</b></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button><buttontype="button" class="btn btn-danger" data-dismiss="modal" onclick="deleteIncome(' + id + ')" >Delete This</button></div></div></div></div>';

                                        }

                                        $('[data-ride="datatables"]').each(function () {
                                            var categoryTable = document.getElementById("incomeTable");
                                            var oTable = $(categoryTable).dataTable({
                                                "bProcessing": true,
                                                "sDom": "<'row'<'col-sm-6'l><'col-sm-6'f>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
                                                "sPaginationType": "full_numbers",
                                                "aoColumns": [
                                                    {"mData": "updated_at"},
                                                    {"mData": "title"},
                                                    {"mData": "amount"},
                                                    {"mData": "category_id"}
                                                ]
                                            });
                                        });
                                    });

                                    function editIncome(id) {
                                        $.get(api + "editIncome/" + id, function (data) {
                                            window.location.replace("editIncome.html?id=" + data['id']);
                                        });
                                    }
                                    function deleteIncome(id) {
                                        $.post(api + "deleteIncome/" + id, function () {
                                            window.location.replace("income.html");
                                        });
                                    }
                                    document.getElementById("cur").innerHTML = localStorage.getItem('cur');
                                </script> 
                            </section> 
                        </section> 
                    </section> 
                    <a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen" data-target="#nav"></a> 
                </section> 
            </section> 
        </section> 
    </section> 
    <script src="js/jquery.min.js"></script> 
    <!-- Bootstrap --> 
    <script src="js/bootstrap.js"></script> 
    <!-- App --> 
    <script src="js/app.js"></script> 
    <script src="js/slimscroll/jquery.slimscroll.min.js"></script> 
    <!-- datatables --> 
    <script src="js/datatables/jquery.dataTables.min.js"></script> 
    <script src="js/datatables/jquery.csv-0.71.min.js"></script> 
    <!--<script src="js/datatables/demo.js"></script>--> 
    <script src="js/app.plugin.js"></script> 
</body> 
</html> 